(function(e){function t(t){for(var o,r,l=t[0],a=t[1],c=t[2],u=0,h=[];u<l.length;u++)r=l[u],Object.prototype.hasOwnProperty.call(n,r)&&n[r]&&h.push(n[r][0]),n[r]=0;for(o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o]);d&&d(t);while(h.length)h.shift()();return s.push.apply(s,c||[]),i()}function i(){for(var e,t=0;t<s.length;t++){for(var i=s[t],o=!0,l=1;l<i.length;l++){var a=i[l];0!==n[a]&&(o=!1)}o&&(s.splice(t--,1),e=r(r.s=i[0]))}return e}var o={},n={app:0},s=[];function r(t){if(o[t])return o[t].exports;var i=o[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=o,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(i,o,function(t){return e[t]}.bind(null,o));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],a=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var d=a;s.push([0,"chunk-vendors"]),i()})({0:function(e,t,i){e.exports=i("cd49")},"099d":function(e,t,i){"use strict";i("21df")},"21df":function(e,t,i){},2309:function(e,t,i){},"490c":function(e,t,i){"use strict";i("2309")},5780:function(e,t,i){},abbc:function(e,t,i){},b09b:function(e,t,i){"use strict";i("bc94")},bc94:function(e,t,i){},cd49:function(e,t,i){"use strict";i.r(t);var o=i("2b0e"),n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-app",[i("v-navigation-drawer",{attrs:{absolute:"",width:"360"},on:{transitionend:function(t){!e.drawer&&(e.drawerSwitch=!0)}},model:{value:e.drawer,callback:function(t){e.drawer=t},expression:"drawer"}},[i("v-toolbar",{attrs:{color:"primary"}},[i("v-toolbar-title",[e._v("Live2D Viewer")]),i("v-spacer"),i("v-btn",{attrs:{icon:"",href:"https://github.com/guansss/live2d-viewer-web"}},[i("v-icon",[e._v("mdi-github")])],1),i("v-btn",{attrs:{icon:""},on:{click:function(t){e.creation.dialog=!0}}},[i("v-icon",[e._v("mdi-plus")])],1),i("v-btn",{attrs:{icon:""},on:{click:function(t){return e.showUI(!1)}}},[i("v-icon",[e._v("mdi-close")])],1)],1),i("v-divider"),i("ModelEditor",{attrs:{id:e.selectedModelID}})],1),i("v-main",[i("v-container",{staticClass:"pa-0 fill-height flex-column",attrs:{fluid:""}},[i("v-spacer"),i("ModelList",{attrs:{show:e.modelList.visible},model:{value:e.selectedModelID,callback:function(t){e.selectedModelID=t},expression:"selectedModelID"}})],1),i("ModelCreation",{on:{create:function(t){e.selectedModelID=t}},model:{value:e.creation.dialog,callback:function(t){e.$set(e.creation,"dialog",t)},expression:"creation.dialog"}})],1),i("v-fab-transition",[i("v-btn",{directives:[{name:"show",rawName:"v-show",value:e.drawerSwitch,expression:"drawerSwitch"}],attrs:{fab:"",top:"",left:"",absolute:"",dark:"",color:"accent"},on:{click:function(t){return e.showUI(!0)}}},[i("v-icon",[e._v("mdi-plus")])],1)],1),i("ModelDropZone",{on:{upload:e.upload,error:e.error}}),i("v-snackbar",{attrs:{timeout:"-1"},scopedSlots:e._u([{key:"action",fn:function(t){var o=t.attrs;return[i("v-btn",e._b({attrs:{icon:""},on:{click:function(t){e.snackbar.visible=!1}}},"v-btn",o,!1),[i("v-icon",[e._v("mdi-close")])],1)]}}]),model:{value:e.snackbar.visible,callback:function(t){e.$set(e.snackbar,"visible",t)},expression:"snackbar.visible"}},[e._v(" "+e._s(e.snackbar.message)+" ")])],1)},s=[],r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-slide-y-reverse-transition",[e.show&&e.models.length?i("v-sheet",{attrs:{width:"100%"}},[i("v-row",{staticClass:"ma-0"},[i("v-item-group",{staticClass:"flex-grow-1",attrs:{mandatory:"",value:e.selectedIndex},on:{change:e.select}},[i("transition-group",{staticClass:"model-list d-flex pa-2",attrs:{name:"move"}},e._l(e.models,(function(t,o){return i("v-item",{key:t.id,scopedSlots:e._u([{key:"default",fn:function(o){var n=o.active,s=o.toggle;return[i("v-card",{staticClass:"ma-2",attrs:{color:t.error?"#631f1f":n?"blue-grey darken-3":"blue-grey darken-4"},on:{click:s}},[i("v-tooltip",{attrs:{top:"",disabled:!t.error},scopedSlots:e._u([{key:"activator",fn:function(o){var s=o.on,r=o.attrs;return[i("v-img",e._g(e._b({attrs:{src:t.thumbnail,width:t.error?192:192*t.aspectRatio,height:"192"},scopedSlots:e._u([{key:"placeholder",fn:function(){return[i("v-row",{staticClass:"fill-height ma-0",attrs:{align:"center",justify:"center"}},[t.error?i("v-icon",[e._v("mdi-alert-circle")]):i("v-progress-circular",{attrs:{indeterminate:"",color:"grey lighten-5"}})],1)]},proxy:!0}],null,!0)},"v-img",r,!1),s),[i("v-card-title",{staticClass:"ml-1 pa-0 flex-nowrap subtitle-1"},[i("span",{staticClass:"model-item-title text-truncate"},[e._v(e._s("#"+t.id+" "+t.name))]),i("v-spacer"),n?i("v-btn",{attrs:{icon:""},on:{click:function(i){return i.stopPropagation(),e.remove(t.id)}}},[i("v-icon",{attrs:{size:"20"}},[e._v("mdi-close")])],1):e._e()],1)],1)]}}],null,!0)},[e._v(" "+e._s(t.error)+" ")])],1)]}}],null,!0)})})),1)],1)],1)],1):e._e()],1)},l=[],a=o["a"].extend({name:"ModelList",props:{value:Number,show:Boolean},data:()=>({models:[]}),computed:{selectedIndex(){return this.models.findIndex(e=>e.id===this.value)}},created(){this.models=this.$live2dApp.models},methods:{select(e){var t,i;const o=null!==(i=null===(t=this.models[e])||void 0===t?void 0:t.id)&&void 0!==i?i:-1;this.$emit("input",o)},remove(e){this.$live2dApp.removeModel(e),0===this.models.length&&this.$emit("input",-1)}}}),c=a,d=(i("d656"),i("2877")),u=i("6544"),h=i.n(u),v=i("8336"),p=i("b0af"),f=i("99d9"),m=i("132d"),g=i("adda"),b=i("d903"),x=i("604c"),w=i("490a"),M=i("0fd9"),y=i("8dd9"),_=i("0789"),F=i("2fa4"),k=i("3a2f"),I=Object(d["a"])(c,r,l,!1,null,"26daa78c",null),V=I.exports;h()(I,{VBtn:v["a"],VCard:p["a"],VCardTitle:f["c"],VIcon:m["a"],VImg:g["a"],VItem:b["a"],VItemGroup:x["b"],VProgressCircular:w["a"],VRow:M["a"],VSheet:y["a"],VSlideYReverseTransition:_["g"],VSpacer:F["a"],VTooltip:k["a"]});var S=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-dialog",{attrs:{value:e.value,width:"800"},on:{input:function(t){return e.$emit("input",t)}}},[i("v-card",[i("v-toolbar",{staticClass:"flex-grow-0",attrs:{color:"primary",flat:"",dense:""}},[i("v-toolbar-title",[e._v("Create Model")]),i("v-spacer"),i("v-btn",{attrs:{icon:""},on:{click:e.create}},[i("v-icon",[e._v("mdi-checkbox-marked-circle-outline")])],1)],1),i("v-card-text",{staticClass:"pa-8"},[i("v-text-field",{attrs:{"single-line":"",filled:"","prepend-icon":"mdi-link",label:"URL",messages:e.urlMessages,error:e.urlError},model:{value:e.url,callback:function(t){e.url=t},expression:"url"}}),i("div",{staticClass:"d-flex mb-4"},[i("v-spacer"),i("v-btn",{attrs:{color:"blue-grey"},on:{click:function(t){e.picker.dialog=!0}}},[e._v(" From source... "),i("v-icon",{attrs:{right:""}},[e._v(" mdi-cloud-search ")])],1)],1),i("v-file-input",{attrs:{multiple:"",filled:"","show-size":"","prepend-icon":"mdi-file-upload",placeholder:"Not implemented yet, please just drag and drop all the files into this page"},nativeOn:{"!click":function(t){return e.fileInputClicked(t)}},model:{value:e.inputFiles,callback:function(t){e.inputFiles=t},expression:"inputFiles"}})],1)],1),i("ModelPicker",{on:{select:function(t){e.url=t}},model:{value:e.picker.dialog,callback:function(t){e.$set(e.picker,"dialog",t)},expression:"picker.dialog"}})],1)},C=[],A=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("v-dialog",{attrs:{value:e.value,width:"80vw"},on:{input:function(t){return e.$emit("input",t)}}},[i("v-card",{staticClass:"d-flex flex-column",attrs:{height:"80vh"}},[i("v-toolbar",{staticClass:"flex-grow-0",attrs:{color:"primary",flat:"",dense:""}},[i("v-toolbar-title",[e._v("Select a Model")]),i("v-spacer"),i("v-btn",{attrs:{icon:""},on:{click:e.submit}},[i("v-icon",[e._v("mdi-checkbox-marked-circle-outline")])],1)],1),i("v-row",{staticClass:"content-row flex-grow-1",attrs:{"no-gutters":""}},[i("v-col",{staticClass:"content-col"},[i("v-card-text",[i("v-treeview",{attrs:{activatable:"","return-object":"","load-children":e.fetchModels,active:e.activeFolders,items:e.tree,"item-key":"id","open-on-click":""},on:{"update:active":function(t){t.length&&(e.activeFolders=t)},"update:open":e.folderOpened},scopedSlots:e._u([{key:"prepend",fn:function(t){var o=t.open;return[i("v-icon",[e._v(" "+e._s(o?"mdi-folder-open":"mdi-folder")+" ")])]}}])})],1)],1),i("v-divider",{attrs:{vertical:""}}),i("v-col",{staticClass:"content-col"},[i("v-card-text",[i("v-list-item-group",{model:{value:e.selectedFileIndex,callback:function(t){e.selectedFileIndex=t},expression:"selectedFileIndex"}},e._l(e.activeFolderFiles,(function(t,o){return i("v-list-item",{key:t,attrs:{color:"primary"},nativeOn:{dblclick:function(t){e.selectedFileIndex=o,e.submit()}}},[i("v-list-item-content",[i("v-list-item-title",[e._v(e._s(t))])],1)],1)})),1)],1)],1)],1),i("v-divider"),i("v-card-actions",[i("v-alert",{directives:[{name:"visible",rawName:"v-visible",value:e.alert,expression:"alert"}],staticClass:"mb-0",attrs:{dense:"",text:"",type:"error"}},[e._v(e._s(e.alert))])],1)],1)],1)},O=[],R=i("41c6"),L=i.n(R);let j=0;const E="https://cdn.jsdelivr.net/gh/",T=new Map,P=[{id:j++,name:"Eikanya/Live2d-model",children:[],files:[]}],$={};function D(){return P}function U(e){if(!P.includes(e))return Promise.resolve();if(!T.get(e)){const t=fetch(e.name.toLowerCase().replace("/","")+".json").then(e=>e.json()).then(t=>{e.name=t.models.name,e.children=t.models.children,e.files=t.models.files,N(e,e=>e.id=j++),Object.assign($,t.settings)});return T.set(e,t),t}return T.get(e)}function N(e,t){if(t(e),e.children)for(const i of e.children)N(i,t)}function W(e,t){const i=J(e);if(i){const e=encodeURI(i+"/"+t);return"https://cdn.jsdelivr.net/gh/"+e}}function J(e){const t=i=>{for(const o of i){if(o===e)return o.name;if(o.children){const e=t(o.children);if(e)return o.name+"/"+e}}};return t(P)}function B(e){if(!e.endsWith("model.json")&&!e.endsWith("model3.json")){if(e.endsWith(".moc")||e.endsWith(".moc3")){if(G(e))return;return"Error: Cannot display a moc file that doesn't belong to any resource repository"}return"Warning: Unknown URL type. The model may not be loaded correctly"}}function G(e){if(e.startsWith(E)){let t=e.replace(E,"");return t=decodeURI(t),$[t]}}P.forEach(U);var X=o["a"].extend({name:"ModelPicker",props:{value:Boolean},data:()=>({search:"",tree:D(),openedFolders:[],activeFolders:[],selectedFileIndex:-1,alert:""}),computed:{activeFolderFiles(){return this.activeFolders.length&&this.activeFolders[0].files||[]}},watch:{activeFolders(e,t){const i=0!==L()(e,t).length;i&&(this.selectedFileIndex=-1)},selectedFileIndex(){this.alert=""}},created(){},methods:{async fetchModels(e){var t,i;await U(e),(null===(t=e.files)||void 0===t?void 0:t.length)&&!(null===(i=e.children)||void 0===i?void 0:i.length)&&(e.children=[{id:Math.random(),name:""}])},folderOpened(e){const t=L()(e,this.openedFolders);t.length?(this.activeFolders=t.slice(0),this.openedFolders=e):this.activeFolders=this.tree.slice(0,1)},submit(){if(this.activeFolders.length&&this.selectedFileIndex>=0){const e=W(this.activeFolders[0],this.activeFolderFiles[this.selectedFileIndex]);e&&this.$emit("select",e)}this.$emit("input",!1)},log(...e){console.log(...e)}}}),z=X,Y=(i("cedb"),i("0798")),Z=i("62ad"),H=i("169a"),q=i("ce7e"),K=i("da13"),Q=i("5d23"),ee=i("1baa"),te=i("71d9"),ie=i("2a7f"),oe=i("eb2a"),ne=Object(d["a"])(z,A,O,!1,null,"c5de567c",null),se=ne.exports;h()(ne,{VAlert:Y["a"],VBtn:v["a"],VCard:p["a"],VCardActions:f["a"],VCardText:f["b"],VCol:Z["a"],VDialog:H["a"],VDivider:q["a"],VIcon:m["a"],VListItem:K["a"],VListItemContent:Q["a"],VListItemGroup:ee["a"],VListItemTitle:Q["b"],VRow:M["a"],VSpacer:F["a"],VToolbar:te["a"],VToolbarTitle:ie["a"],VTreeview:oe["a"]});var re=o["a"].extend({components:{ModelPicker:se},name:"ModelCreation",props:{value:Boolean},data:()=>({url:"",picker:{dialog:!1},urlError:!1,urlMessages:[],files:[],inputFiles:[],fileError:!1,fileMessages:[]}),watch:{url(e){const t=B(e)||"";this.urlError=/error/i.test(t),this.urlMessages=[t].filter(Boolean)},inputFiles(e){console.log(e)}},methods:{create(){if(this.url=this.url.replace(/\s/,""),this.url||(this.urlError=!0,this.urlMessages=["Please enter a URL"]),this.urlError)return;const e=this.$live2dApp.addModel(this.url);this.$emit("input",!1),this.$emit("create",e)},fileInputClicked(e){const t=e.target.classList.contains("v-icon");this.inputFiles.length&&!t&&e.stopPropagation()}}}),le=re,ae=i("23a7"),ce=i("8654"),de=Object(d["a"])(le,S,C,!1,null,"5bbd66a8",null),ue=de.exports;h()(de,{VBtn:v["a"],VCard:p["a"],VCardText:f["b"],VDialog:H["a"],VFileInput:ae["a"],VIcon:m["a"],VSpacer:F["a"],VTextField:ce["a"],VToolbar:te["a"],VToolbarTitle:ie["a"]});var he=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.model?i("div",{staticClass:"model-editor"},[i("div",{staticClass:"pa-2 d-flex align-center"},[i("div",{staticClass:"text-h4"},[e._v(e._s("#"+e.model.id))])]),i("div",{staticClass:"pa-2 text-h5"},[e._v(e._s(e.model.name))]),i("v-list",{attrs:{expand:""}},[i("v-list-group",{attrs:{value:!0},scopedSlots:e._u([{key:"activator",fn:function(){return[i("v-list-item-content",[i("v-list-item-title",[e._v("Display")])],1)]},proxy:!0}],null,!1,1435882642)},[i("v-list-item",[i("v-list-item-content",[i("div",[i("v-slider",{staticClass:"mt-2",attrs:{dense:"","prepend-icon":"mdi-magnify",messages:String(e.model.scaleX),min:"0.01",max:"3",step:"0.01"},model:{value:e.model.scaleX,callback:function(t){e.$set(e.model,"scaleX",t)},expression:"model.scaleX"}}),i("v-slider",{staticClass:"mt-2",attrs:{dense:"","prepend-icon":"mdi-rotate-right",messages:e.rotationDeg,min:"0",max:"6.28",step:"0.01"},model:{value:e.model.rotation,callback:function(t){e.$set(e.model,"rotation",t)},expression:"model.rotation"}})],1)])],1)],1),i("v-list-group",{scopedSlots:e._u([{key:"activator",fn:function(){return[i("v-list-item-content",[i("v-list-item-title",[e._v("Motions")])],1)]},proxy:!0},{key:"default",fn:function(){return[e._l(e.motionGroups,(function(t){return[i("v-subheader",{key:t.name,staticClass:"px-3"},[e._v(e._s(t.name||"(Nameless)"))]),e._l(t.motions,(function(o,n){return i("v-list-item",{key:t.name+n,attrs:{ripple:""},on:{click:function(i){return e.startMotion(t,n)}}},[i("v-list-item-content",[i("v-list-item-title",{class:{"primary--text":e.motionState.currentGroup===t.name&&e.motionState.currentIndex===n}},[e._v(" "+e._s(o.file)+" ")])],1),i("v-list-item-icon",{staticClass:"my-0 align-self-center"},[e.motionState.currentGroup===t.name&&e.motionState.currentIndex===n?i("v-icon",{attrs:{size:"32",color:"primary"}},[e._v("mdi-play")]):e.motionState.reservedGroup===t.name&&e.motionState.reservedIndex===n||e.motionState.reservedIdleGroup===t.name&&e.motionState.reservedIdleIndex===n?i("v-progress-circular",{attrs:{indeterminate:"",size:"20"}}):e._e()],1)],1)}))]}))]},proxy:!0}],null,!1,847292484)})],1)],1):e._e()},ve=[],pe=i("0949"),fe=o["a"].extend({name:"ModelEditor",props:{id:{type:Number,default:-1}},data:()=>({model:null,selectedMotionGroup:"",selectedMotionIndex:-1,motionGroups:[],motionState:null,activeMotionIndex:-1}),computed:{rotationDeg(){var e;return Math.round(((null===(e=this.model)||void 0===e?void 0:e.rotation)||0)/Math.PI*180)+"°"}},watch:{id:{immediate:!0,handler(){this.updateModel()}},scaleX(e){this.model.scale(e,e)},rotation(e){this.model.rotate(e)}},methods:{updateModel(){this.resetModel(),this.model=this.$live2dApp.getModel(this.id),this.model&&(this.model.pixiModel?this.pixiModelLoaded(this.model.pixiModel):this.model.once("modelLoaded",this.pixiModelLoaded))},resetModel(){this.model&&(this.model.off("modelLoaded",this.pixiModelLoaded),this.motionGroups=[],this.motionState=void 0,this.model=void 0)},pixiModelLoaded(e){const t=[],i=e.internalModel.motionManager.definitions;for(const[o,n]of Object.entries(i))t.push({name:o,motions:(null===n||void 0===n?void 0:n.map(e=>({file:e.file||e.File})))||[]});this.motionGroups=t,this.motionState=e.internalModel.motionManager.state},startMotion(e,t){this.model.pixiModel.motion(e.name,t,pe["MotionPriority"].FORCE)}}}),me=fe,ge=(i("099d"),i("8860")),be=i("56b0"),xe=i("34c3"),we=i("ba0d"),Me=i("e0c7"),ye=Object(d["a"])(me,he,ve,!1,null,"60e12254",null),_e=ye.exports;h()(ye,{VIcon:m["a"],VList:ge["a"],VListGroup:be["a"],VListItem:K["a"],VListItemContent:Q["a"],VListItemIcon:xe["a"],VListItemTitle:Q["b"],VProgressCircular:w["a"],VSlider:we["a"],VSubheader:Me["a"]});var Fe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:["drop-zone",{active:e.draggingOver}]},[e.draggingOver?i("div",{staticClass:"text-h1"},[e._v("Drop Files")]):e._e()])},ke=[];function Ie(e){return e.endsWith("model.json")}function Ve(e){return e.endsWith("model3.json")}function Se(e){return Ie(e)||Ve(e)}function Ce(e){return e.endsWith(".moc")}function Ae(e){return e.endsWith(".moc3")}function Oe(e){return Ce(e)||Ae(e)}var Re=i("aa81");function Le(e){const t=[];return e.replaceFiles((e,i)=>(t.push(e),e)),t}function je(e){if(!e.resolveURL.overridden){const t=e.resolveURL;e.resolveURL=function(e){var i,o;return null!==(o=null===(i=Ee.filesMap[this.url])||void 0===i?void 0:i[e])&&void 0!==o?o:t.call(this,e)},e.resolveURL.overridden=!0}}pe["Cubism2ModelSettings"].prototype.replaceFiles=function(e){this.moc=e(this.moc,"moc"),void 0!==this.pose&&(this.pose=e(this.pose,"pose")),void 0!==this.physics&&(this.physics=e(this.physics,"physics"));for(let t=0;t<this.textures.length;t++)this.textures[t]=e(this.textures[t],`textures[${t}]`);for(const[t,i]of Object.entries(this.motions))for(let o=0;o<i.length;o++)i[o].file=e(i[o].file,`motions.${t}[${o}].file`),void 0!==i[o].sound&&(i[o].sound=e(i[o].sound,`motions.${t}[${o}].sound`));if(this.expressions)for(let t=0;t<this.expressions.length;t++)this.expressions[t].file=e(this.expressions[t].file,`expressions[${t}]`)};class Ee{static validate(e){}static async upload(e){const t=await Ee.createSettings(e),i=t.localFilePath,o=Le(t),n={};for(const s of o){const t=Re["url"].resolve(i,s),o=e.find(e=>e.webkitRelativePath===t);o&&(n[s]=URL.createObjectURL(o))}return Ee.filesMap[t.url]=n,t}static async createSettings(e){const t=e.find(e=>{var t;return null!==(t=e.name.endsWith(".model.json"))&&void 0!==t?t:e.name.endsWith(".model3.json")});if(!t)throw new TypeError("Settings file not found");const i=await Ee.readText(t),o=JSON.parse(i);let n;if(o.url=URL.createObjectURL(t),Ie(t.name)){if(!pe["Cubism2ModelSettings"].isValidJSON(o))throw new Error("Invalid settings JSON v2");n=new pe["Cubism2ModelSettings"](o)}else{if(!Ve(t.name))throw new Error("Unknown settings JSON");if(!pe["Cubism4ModelSettings"].isValidJSON(o))throw new Error("Invalid settings JSON v3");n=new pe["Cubism4ModelSettings"](o)}const s=t.webkitRelativePath,r=t=>{const i=Re["url"].resolve(s,t);if(!e.find(e=>e.webkitRelativePath===i))throw new Error(`File "${t}" is defined in settings, but does not exist in uploaded files`)};return r(n.moc),n.textures.forEach(r),n.localFilePath=s,n}static async readText(e){return new Promise((t,i)=>{const o=new FileReader;o.onload=()=>t(o.result),o.onerror=i,o.readAsText(e,"utf8")})}}Ee.filesMap={},Ee.factory=async(e,t)=>{if(Array.isArray(e.source)&&e.source[0]instanceof File){const t=await Ee.upload(e.source);je(t),e.source=t,e.live2dModel.once("modelLoaded",e=>{e.once("destroy",(function(){if(Ee.filesMap[this.settings.url])for(const e of Object.values(Ee.filesMap[this.settings.url]))URL.revokeObjectURL(e);delete Ee.filesMap[this.settings.url]}))})}return t()},pe["Live2DFactory"].live2DModelMiddlewares.unshift(Ee.factory);const Te=5;let Pe=0;const $e=Ee.createSettings;async function De(e){const t=Ue(e);if(t.length){const e=new Set;let i;if(await Promise.allSettled(t.map(async t=>{try{await Ee.createSettings(t),t.forEach(t=>e.add(t))}catch(o){i=i||o}})),!e.size)throw i=i||new Error("Unknown error"),i;return[...e]}return Ne(e),e}function Ue(e){const t=[],i=[];for(const o of e)Se(o.name)?t.push(o):i.push(o);if(t.length>Te)throw new Error(`Too many settings files ${t.length}/${Te}`);return t.map(e=>[e,...i])}function Ne(e){const t=e.filter(e=>Oe(e.name));if(1!==t.length){const e=t.length?`(${t.map(e=>`"${e}"`).join(",")})`:"";throw new Error(`Expected exactly one moc file, got ${t.length} ${e}`)}const i=t[0].webkitRelativePath,o=e.map(e=>e.webkitRelativePath),n=o.filter(e=>e.endsWith(".png"));if(!n.length)throw new Error("Textures not found");const s=o.filter(e=>e.endsWith(".mtn")||e.endsWith(".motion3.json")),r=o.find(e=>e.includes("physics")),l=o.find(e=>e.includes("pose"));let a,c="dummy"+Pe++;return Ce(i)?(c+=".model.json",a=new pe["Cubism2ModelSettings"]({url:"blob://"+c,textures:n,pose:l,physics:r,model:i,motions:s.length?{"":s.map(e=>({file:e}))}:void 0})):(c+=".model3.json",a=new pe["Cubism4ModelSettings"]({url:"blob://"+c,Version:3,FileReferences:{Moc:i,Textures:n,Physics:r,Pose:l,Motions:s.length?{"":s.map(e=>({File:e}))}:void 0}})),a.localFilePath=c,a}function We(e){var t;return!!(null===(t=e.dataTransfer)||void 0===t?void 0:t.types.some(e=>"Files"===e))}async function Je(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].webkitGetAsEntry());return Be(t)}async function Be(e){const t=[];return await Promise.all(e.map(async e=>{if(e.isFile)t.push(await Xe(e));else if(e.isDirectory){const i=await Ge(e);t.push(...await Be(i))}})),t}function Ge(e){return new Promise((t,i)=>{e.createReader().readEntries(t,i)})}async function Xe(e){const t=await new Promise((t,i)=>e.file(t,i));let i=e.fullPath;return i.startsWith("/")&&(i=i.slice(1)),Object.defineProperty(t,"webkitRelativePath",{value:i}),t}Ee.createSettings=async e=>e.find(e=>Se(e.name))?$e(e):Ne(e);var ze=o["a"].extend({name:"ModelDropZone",data:()=>({draggingOver:!1}),created(){document.ondragenter=e=>We(e)&&(this.draggingOver=!0),document.ondragleave=e=>We(e)&&(this.draggingOver=!!e.relatedTarget),document.ondragover=e=>We(e)&&e.preventDefault(),document.ondrop=e=>We(e)&&this.drop(e)},methods:{async drop(e){var t;if(e.preventDefault(),this.draggingOver=!1,null===(t=e.dataTransfer)||void 0===t?void 0:t.items.length){const t=await Je(e.dataTransfer.items);try{const e=await De(t);this.$emit("upload",e)}catch(e){e.message="Failed to load model: "+e.message,this.$emit("error",e)}}}}}),Ye=ze,Ze=(i("f374"),Object(d["a"])(Ye,Fe,ke,!1,null,"206dfa3a",null)),He=Ze.exports,qe=o["a"].extend({name:"App",components:{ModelList:V,ModelCreation:ue,ModelEditor:_e,ModelDropZone:He},data:()=>({drawer:!0,drawerSwitch:!1,loading:!1,modelList:{visible:!0},selectedModelID:-1,creation:{dialog:!1,result:null},drop:{},snackbar:{visible:!1,message:""},models:[]}),computed:{},methods:{showUI(e){this.drawer=e,this.modelList.visible=e,this.drawerSwitch=!1},upload(e){this.$live2dApp.addModels(e)},error(e){const t=e&&e.message||e+"";t&&(this.snackbar.message=t,this.snackbar.visible=!0)},log(...e){console.log(...e)}},created(){this.models=this.$live2dApp.models,this.creation.dialog=!0}}),Ke=qe,Qe=(i("b09b"),i("490c"),i("7496")),et=i("a523"),tt=i("f6c4"),it=i("f774"),ot=i("2db4"),nt=Object(d["a"])(Ke,n,s,!1,null,"0969cdf0",null),st=nt.exports;h()(nt,{VApp:Qe["a"],VBtn:v["a"],VContainer:et["a"],VDivider:q["a"],VFabTransition:_["c"],VIcon:m["a"],VMain:tt["a"],VNavigationDrawer:it["a"],VSnackbar:ot["a"],VSpacer:F["a"],VToolbar:te["a"],VToolbarTitle:ie["a"]});var rt=i("f309");o["a"].use(rt["a"]);var lt=new rt["a"]({theme:{dark:!0,options:{customProperties:!0},themes:{light:{primary:"#ee44aa",secondary:"#424242",accent:"#82B1FF",error:"#FF5252",info:"#2196F3",success:"#4CAF50",warning:"#FFC107"}}}}),at=i("3e85");class ct extends pe["Live2DModel"]{constructor(){super(),this.once("modelLoaded",this._init)}_init(){var e,t;this.hitAreaFrames=new at["a"],this.addChild(this.hitAreaFrames),this.anchor.set(.5,.5),this.on("hit",this.startHitMotion),null===(t=(e=this.internalModel.motionManager.queueManager).setEventCallback)||void 0===t||t.call(e,(e,t)=>{this.emit("motion:"+t)})}startHitMotion(e){for(let t of e){t=t.toLowerCase();const e=[t,"tap"+t,"tap_"+t,"tap"];for(const t of e)for(let e of Object.keys(this.internalModel.motionManager.definitions))if(t===e.toLowerCase())return void this.motion(e)}}}function dt(e){const t=e;t.buttonMode=!0,t.on("pointerdown",ut),t.on("pointermove",ht),t.on("pointerup",vt),t.on("pointerupoutside",vt)}function ut(e){this.dragging=!0,this._pointerX=e.data.global.x-this.x,this._pointerY=e.data.global.y-this.y}function ht(e){this.dragging&&(this.position.x=e.data.global.x-this._pointerX,this.position.y=e.data.global.y-this._pointerY)}function vt(e){this.dragging=!1}const pt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mMU22h6EgADqAHHuWdgTgAAAABJRU5ErkJggg==";let ft=1;class mt extends Re["EventEmitter"]{constructor(e){super(),this.id=ft++,this.url="",this.thumbnail="",this.aspectRatio=1,this.name="New Model",this.visible=!0,this._scaleX=1,this._scaleY=1,this._rotation=0,this._zIndex=0,this.error="",this.loadModel(e).then()}async loadModel(e){this.url="string"===typeof e?e:"(Local files)";try{this.pixiModel=await ct.from(e)}catch(t){this.error=t instanceof Error?t.message:t+""}this.pixiModel&&(this.initModel(this.pixiModel),this.emit("modelLoaded",this.pixiModel))}initModel(e){this.pixiModel=e,this.name=e.internalModel.settings.name,this.thumbnail=pt,this.aspectRatio=e.width/e.height,dt(e)}fit(e,t){if(this.pixiModel){let i=Math.min(e/this.pixiModel.width,t/this.pixiModel.height);i=Math.round(10*i)/10,this.scale(i,i)}}scale(e,t){this._scaleX=null!==e&&void 0!==e?e:this._scaleX,this._scaleY=null!==t&&void 0!==t?t:this._scaleY,this.pixiModel&&this.pixiModel.scale.set(this._scaleX,this._scaleY)}rotate(e){this._rotation=e,this.pixiModel&&(this.pixiModel.rotation=e)}setZIndex(e){this._zIndex=e,this.pixiModel&&(this.pixiModel.zIndex=e)}setVisible(e){this.visible=e,this.pixiModel&&(this.pixiModel.visible=e)}destroy(){this.pixiModel&&(this.pixiModel.destroy({children:!0}),this.pixiModel=void 0)}get zIndex(){return this._zIndex}set zIndex(e){this.setZIndex(e)}get rotation(){return this._rotation}set rotation(e){this.rotate(e)}get scaleY(){return this._scaleY}set scaleY(e){this.scale(void 0,e)}get scaleX(){return this._scaleX}set scaleX(e){this.scale(e,e)}}var gt=i("568e"),bt=i("c29d"),xt=i("e3e9"),wt=i("6129"),Mt=i("9bfd"),yt=i("b0a0"),_t=i("5e48"),Ft=i.n(_t);async function kt(e){try{return(await fetch(e)).ok}catch(t){return!1}}async function It(e,t){var i,o,n,s;if("string"===typeof e.source){const t=e.source;let r;if(t.endsWith(".moc")||t.endsWith(".moc3")){if(r=G(t),!r)throw new Error("Cannot find settings JSON from moc");if(t.endsWith("moc3")){r.url=Re["url"].resolve(t,"dummy.model3.json");const e=r;e.FileReferences.Moc=t,(null===(o=null===(i=e.FileReferences.Motions)||void 0===i?void 0:i[""])||void 0===o?void 0:o.length)&&"string"===typeof e.FileReferences.Motions[""][0]&&(e.FileReferences.Motions[""]=e.FileReferences.Motions[""].map(e=>({File:e})))}else{r.url=Re["url"].resolve(t,"dummy.model.json");const e=r;e.model=t,(null===(s=null===(n=e.motions)||void 0===n?void 0:n[""])||void 0===s?void 0:s.length)&&"string"===typeof e.motions[""][0]&&(e.motions[""]=e.motions[""].map(e=>({file:e})))}}else{let e=await fetch(t).then(e=>e.text());e=Vt(e,t),r=Ft.a.parse(e),r.url=t}await St(r,t),At(r),e.source=r,console.log(r),e.live2dModel.emit("settingsJSONLoaded",r)}return t()}function Vt(e,t){for(const i of Ct)t.includes(encodeURI(i.search))&&i.replace&&(e=i.replace(e,t));return e}async function St(e,t){for(const i of Ct)t.includes(encodeURI(i.search))&&i.patch&&await i.patch(e,t)}pe["Live2DFactory"].live2DModelMiddlewares.splice(pe["Live2DFactory"].live2DModelMiddlewares.indexOf(pe["urlToJSON"]),1,It);const Ct=[{search:"魂器学院",replace(e){return e.replace(/mtn"([^,])/gm,'mtn",$1')},patch(e){if(e.textures&&!Array.isArray(e.textures)){const t=Object.values(e.textures)[0];Array.isArray(t)&&(e.textures=t.map(e=>e.startsWith("textures/")?e:"textures/"+e))}}},{search:"少女前线",async patch(e,t){var i,o,n;if(null===(o=null===(i=e.motions)||void 0===i?void 0:i.idle)||void 0===o?void 0:o.length){const i=e.motions.idle[0];if(null===(n=i.file)||void 0===n?void 0:n.startsWith("daiji")){const e=await kt(Re["url"].resolve(t,i.file));e||(i.file="motions/"+i.file)}}Ot(e,["daiji"])}},{search:"アンノウンブライド",async patch(e,t){var i,o;if(0===(null===(o=null===(i=e.FileReferences)||void 0===i?void 0:i.Textures)||void 0===o?void 0:o.length)){const i=await kt(Re["url"].resolve(t,"textures/texture_00.png"));e.FileReferences.Textures.push(i?"textures/texture_00.png":"textures/texture_00 .png")}Rt(e,["home","gacha"])}},{search:"凍京",async patch(e,t){var i,o,n,s,r;const l=async e=>await kt(Re["url"].resolve(t,e))?e:e.replace("/texture","/android/texture");if(pe["Cubism2ModelSettings"].isValidJSON(e)){if(e.textures&&(e.textures=await Promise.all(e.textures.map(l))),e.motions){for(const t of Object.values(e.motions))if(null===t||void 0===t?void 0:t.length)for(const e of t)e.file=null!==(i=e.file)&&void 0!==i?i:e.File,delete e.File;!(null===(o=e.motions.idle)||void 0===o?void 0:o.length)&&e.motions[""]&&(e.motions.idle=e.motions[""].filter(e=>{var t;return null===(t=e.file)||void 0===t?void 0:t.includes("loop")}))}}else pe["Cubism4ModelSettings"].isValidJSON(e)&&((null===(n=e.FileReferences)||void 0===n?void 0:n.Textures)&&(e.FileReferences.Textures=await Promise.all(e.FileReferences.Textures.map(l))),(null===(s=e.FileReferences)||void 0===s?void 0:s.Motions)&&!(null===(r=e.FileReferences.Motions.Idle)||void 0===r?void 0:r.length)&&e.FileReferences.Motions[""]&&(e.FileReferences.Motions.Idle=e.FileReferences.Motions[""].filter(e=>{var t;return null===(t=e.File)||void 0===t?void 0:t.includes("loop")})))}},{search:"天命之子",patch(e){var t,i,o,n,s;(null===(i=null===(t=e.motions)||void 0===t?void 0:t[""])||void 0===i?void 0:i.length)&&!(null===(n=null===(o=e.motions)||void 0===o?void 0:o.idle)||void 0===n?void 0:n.length)&&(e.motions.idle=null===(s=e.motions)||void 0===s?void 0:s[""].map(e=>Object.assign({},e)))}},{search:"碧蓝航线",patch(e){Rt(e,["idle"])}},{search:"少女咖啡枪",patch(e){Rt(e,["stand"])}},{search:"princesses",patch(e){Ot(e,["default","loop"])}},{search:"崩坏",patch(e){Lt(e)}},{search:"战舰少女",patch(e){Lt(e)}},{search:"机动战队",patch(e){Lt(e)}}];function At(e){var t,i,o;const n=null===(t=e.FileReferences)||void 0===t?void 0:t.Motions;n&&((null===(i=n.Idle)||void 0===i?void 0:i[0])||1!==(null===(o=n[""])||void 0===o?void 0:o.length)||(n.Idle=n[""].map(e=>Object.assign({},e))))}function Ot(e,t){if(e.motions){const i=[];for(const[o,n]of Object.entries(e.motions))if("idle"!==o&&Array.isArray(n))for(const e of n)for(const o of t)e.file&&e.file.toLowerCase().includes(o)&&i.push(e);i.length&&(e.motions.idle=(e.motions.idle||[]).concat(i))}}function Rt(e,t){var i;if(null===(i=e.FileReferences)||void 0===i?void 0:i.Motions){const i=[];for(const[o,n]of Object.entries(e.FileReferences.Motions))if("Idle"!==o&&Array.isArray(n))for(const e of n)for(const o of t)e.File&&e.File.toLowerCase().includes(o)&&i.push(e);i.length&&(e.FileReferences.Motions.Idle=(e.FileReferences.Motions.Idle||[]).concat(i))}}function Lt(e){if(e.motions)for(const t of Object.values(e.motions))if(null===t||void 0===t?void 0:t.length)for(const e of t)e.sound=void 0}gt["a"].registerPlugin(xt["b"]),ct.registerTicker(xt["a"]),bt["Renderer"].registerPlugin("extract",Mt["a"]),bt["Renderer"].registerPlugin("batch",bt["BatchRenderer"]),bt["Renderer"].registerPlugin("interaction",wt["a"]),pe["config"].logLevel=pe["config"].LOG_LEVEL_VERBOSE;class jt{constructor(e){this.models=[],this.pixiApp=new gt["a"]({view:e,resizeTo:window,antialias:!0}),this.pixiApp.stage.interactive=!0}addModel(e){const t=new mt(e);return this.initModel(t),this.models.push(t),t.id}addModels(e){const t=Ue(e);for(const i of t){const t=new mt(e);this.initModel(t),this.models.push(t)}}getModel(e){return this.models.find(t=>t.id===e)}initModel(e){e.on("modelLoaded",t=>{if(!this.pixiApp.stage.children.includes(t)){this.pixiApp.stage.addChild(t),t.position.set(this.pixiApp.renderer.width/2,this.pixiApp.renderer.height/2),e.fit(this.pixiApp.renderer.width,this.pixiApp.renderer.height);try{e.thumbnail=this.createThumbnail(t)}catch(i){e.error=i.message}}})}createThumbnail(e){let t;yt["b"].RESOLUTION=.2,e.hitAreaFrames.visible=!1;try{t=this.pixiApp.renderer.extract.base64(e,"image/webp",.01)}finally{yt["b"].RESOLUTION=1,e.hitAreaFrames.visible=!0}return t}removeModel(e){const t=this.models.find(t=>t.id===e);t&&(this.models.splice(this.models.indexOf(t),1),t.pixiModel&&this.pixiApp.stage.removeChild(t.pixiModel),t.destroy())}}const Et=new jt(document.getElementById("canvas"));o["a"].prototype.$live2dApp=Et,o["a"].config.productionTip=!1,o["a"].directive("visible",(function(e,t){e.style.visibility=t.value?"visible":"hidden"})),window.app=new o["a"]({vuetify:lt,render:e=>e(st)}).$mount("#app"),window.config=pe["config"]},cedb:function(e,t,i){"use strict";i("5780")},d656:function(e,t,i){"use strict";i("f48f")},f374:function(e,t,i){"use strict";i("abbc")},f48f:function(e,t,i){}});
//# sourceMappingURL=app.9ca8cf3a.js.map